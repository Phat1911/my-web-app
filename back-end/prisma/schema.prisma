generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id String @id @default(uuid())
  number Int @default(autoincrement())
  name String
  email String @unique
  password String 
  previewURL String @default("")
  score Float @default(0)
  createAt DateTime @default(now())
  lastTaskAssigned DateTime?

  followed Int[] @default([])
  following String[] @default([])
  watchlistItems WatchListItem[]
  movies Movie[] @relation("MovieCreator")
  favMovies Movie[] @relation("Fan") 
  tasks Task[]
  sentMessages Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")
}

model Task {
  id String @id @default(uuid())
  userId String
  gameId Int
  targetScore Float
  completed Boolean @default(false)
  assignedAt DateTime @default(now())
  completedAt DateTime?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  game Game @relation(fields: [gameId], references: [id], onDelete: Cascade)
}

model Message {
  id String @id @default(uuid())
  senderId String
  receiverId String
  content String
  read Boolean @default(false)
  createdAt DateTime @default(now())

  sender User @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)
}

model Game {
  id Int @id @default(autoincrement())
  title String
  image String 
  value Float
  updateAt DateTime @default(now()) 
  createAt DateTime @default(now())
  tasks Task[]
}

model Movie {
  id String @id @default(uuid())
  title String
  overview String
  releaseYear Int
  genres String[] @default([])
  runtime Int?
  posterUrl String?
  createdBy String?
  likedBy String?
  createAt DateTime @default(now())

  creator User? @relation("MovieCreator", fields: [createdBy], references: [id], onDelete: Cascade)
  fan User? @relation("Fan", fields: [likedBy], references: [id], onDelete: Cascade)
  watchlistItems WatchListItem[]
}

model WatchListItem {
  id String @id @default(uuid())
  userId String
  movieId String
  status WatchListStatus @default(PLANNED)
  rating Int? 
  notes String?
  createAt DateTime @default(now())
  updateAt DateTime @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade) 
  movie Movie @relation(fields: [movieId], references: [id], onDelete: Cascade)

  @@unique([userId, movieId]) 
}

enum WatchListStatus {
  PLANNED
  WATCHING
  COMPLETED
  DROPPED 
}